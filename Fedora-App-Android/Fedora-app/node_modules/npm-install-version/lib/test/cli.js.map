{"version":3,"sources":["../../src/test/cli.js"],"names":["spawnSync","require","fs","path","test","clean","CLI_PATH","join","__dirname","run","commands","stdio","packageJson","readFileSync","t","equal","JSON","parse","version","end","packageJson1","packageJson2","out","stdout","toString","status","indexOf","length","stderr"],"mappings":"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","file":"cli.js","sourcesContent":["const spawnSync = require('child_process').spawnSync;\nconst fs = require('fs');\nconst path = require('path');\nconst test = require('tape');\n\nconst { clean } = require('./test-util.js');\n\nconst CLI_PATH = path.join(__dirname, '..', 'cli.js');\nfunction run (...commands) {\n  spawnSync(CLI_PATH, commands, { stdio: [0, 1, 2] });\n}\n\ntest('cli install normal', t => {\n  clean();\n  run('csjs@1.0.0');\n  const packageJson = fs.readFileSync('node_modules/csjs@1.0.0/package.json');\n  t.equal(JSON.parse(packageJson).version, '1.0.0');\n  t.end();\n});\n\ntest('cli install remote', t => {\n  clean();\n  run('scott113341/csjs#extract-extends-performance');\n  const packageJson = fs.readFileSync('node_modules/scott113341-csjs#extract-extends-performance/package.json');\n  t.equal(JSON.parse(packageJson).version, '1.0.4');\n  t.end();\n});\n\ntest('cli install scoped', t => {\n  clean();\n  run('@scott113341/niv-scoped-test@1.0.0');\n  const packageJson = fs.readFileSync('node_modules/@scott113341-niv-scoped-test@1.0.0/package.json');\n  t.equal(JSON.parse(packageJson).version, '1.0.0');\n  t.end();\n});\n\ntest('cli install w/ dependencies', t => {\n  clean();\n  run('push-dir@0.2.2');\n  const packageJson = fs.readFileSync('node_modules/push-dir@0.2.2/package.json');\n  t.equal(JSON.parse(packageJson).version, '0.2.2');\n  t.end();\n});\n\ntest('cli install w/ destination', t => {\n  clean();\n  run('csjs@1.0.0', '--destination=csjs@yolo');\n  const packageJson = fs.readFileSync('node_modules/csjs@yolo/package.json');\n  t.equal(JSON.parse(packageJson).version, '1.0.0');\n  t.end();\n});\n\ntest('cli install w/o overwrite', t => {\n  clean();\n  run('csjs@1.0.0', '--destination=csjs@yolo');\n  const packageJson1 = fs.readFileSync('node_modules/csjs@yolo/package.json');\n  t.equal(JSON.parse(packageJson1).version, '1.0.0');\n\n  run('csjs@1.0.1', '--destination=csjs@yolo');\n  const packageJson2 = fs.readFileSync('node_modules/csjs@yolo/package.json');\n  t.equal(JSON.parse(packageJson2).version, '1.0.0');\n\n  t.end();\n});\n\ntest('cli install w/ overwrite', t => {\n  clean();\n  run('csjs@1.0.0', '--destination=csjs@yolo');\n  const packageJson1 = fs.readFileSync('node_modules/csjs@yolo/package.json');\n  t.equal(JSON.parse(packageJson1).version, '1.0.0');\n\n  run('csjs@1.0.1', '--destination=csjs@yolo', '--overwrite');\n  const packageJson2 = fs.readFileSync('node_modules/csjs@yolo/package.json');\n  t.equal(JSON.parse(packageJson2).version, '1.0.1');\n\n  t.end();\n});\n\ntest('cli help', t => {\n  clean();\n  const out = spawnSync(CLI_PATH, ['--help']);\n  const stdout = out.stdout.toString();\n  t.equal(out.status, 0);\n  t.equal(stdout.indexOf('usage: niv <package> [options...]'), 0);\n  t.equal(stdout.length > 100, true);\n  t.end();\n});\n\ntest('cli no package', t => {\n  clean();\n  const out = spawnSync(CLI_PATH);\n  const stderr = out.stderr.toString();\n  t.equal(out.status, 1);\n  t.equal(stderr.indexOf('usage: niv <package> [options...]'), 0);\n  t.equal(stderr.length > 100, true);\n  t.end();\n});\n"]}